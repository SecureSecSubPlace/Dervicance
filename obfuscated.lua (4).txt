return function(encryptedString)
    local shift, map, encryptedData = encryptedString:match("^(%d+)%*(.-)%*(.+)$")
    shift = tonumber(shift) or 0

    -- Convert the map back into an indexed table
    local mapTable = {}
    for num in map:gmatch("%d+") do
        table.insert(mapTable, tonumber(num))
    end

    -- Decrypt function using the custom mapping
    local function decryptChar(char, index)
        local mappedIndex = mapTable[index] or 0
        local decryptedValue = string.byte(char) - (shift % 256) - mappedIndex
        return string.char((decryptedValue % 256) + 1)
    end

    -- Decrypt the data
    local decryptedString = {}
    local index = 1
    for char in encryptedData:gmatch(".") do
        table.insert(decryptedString, decryptChar(char, index))
        index = index + 1
    end

    return table.concat(decryptedString)
end
